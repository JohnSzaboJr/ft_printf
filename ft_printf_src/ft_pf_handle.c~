/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_pf_handle.c                                     :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: jszabo <marvin@42.fr>                      +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2018/02/14 14:49:38 by jszabo            #+#    #+#             */
/*   Updated: 2018/02/14 18:23:04 by jszabo           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "../libft.h"
#include "../ft_printf.h"
//
#include <stdio.h>

int	ft_pf_handle_percent(int *ret)
{
	ft_putchar('%');
	(*ret)++;
	return (1);
}

int	ft_pf_handle_strings(int *ret, va_list args, t_print *features)
{
	char 	*str;
	char 	*new;
	char 	*spaces;
	size_t	len;

	len = 0;
	if (features->type == 'S')
		return (0);
	if (features->type == 's')
	{
		str = va_arg(args, char*);
		// check here if there is anything
		if (!(new = ft_strdup(str)))
			return (0);
		str = NULL;
		if (ft_strlen(new) > features->precision)
			new[features->precision] = '\0';
		len = new[0] ? ft_strlen(new) : 0;
		if (features->width > len)
		{
			if (!(spaces = ft_strnew(features->width - len)))
				return (0);
			if (features->fl_prep_zeros)
				spaces = ft_strnfill(spaces, '0', (features->width - len));
			else
				spaces = ft_strnfill(spaces, ' ', (features->width - len));
			if (len)
			{
				str = (features->fl_left_just) ? ft_strjoin(new, spaces) :
				ft_strjoin(spaces, new);
				free(new);
				free(spaces);
				new = ft_strdup(str);
				free(str);
			}
			else
			{
				free(new);
				new = ft_strdup(spaces);
				free(spaces);
			}

			// handle wrong returns of strnew, join, dup...
			// make separate functions for these
		}
		ft_putstr(new);
		ret = ret + ft_strlen(new);
		free(new);
	}
	return (1);
}
